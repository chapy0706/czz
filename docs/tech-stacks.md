# 技術スタックとライブラリ選定

## 思想

- 小さく・単純に・単一責務（UNIX 哲学）
- 型安全を最優先して設計ミスをコンパイル時に防ぐ
- OSS を尊重し、必要な部分だけを組み合わせて育てていく
- TDD・E2E による高品質の担保
- スマホ中心のゲームとしてリッチで心地よい UX を目指す

---

# フレームワーク / 基盤

## Next.js

- React ベースのモダンフレームワーク
- SSG / ISR / SSR を柔軟に選択可能
- App Router による明確な構造と型安全 API Routes
- Vercel との親和性が高い

## TypeScript

- DSL・API・DB・フロント全層を型で統一
- 仕様の「唯一の真実」を型に集約できる

## pnpm

- 最も高速・軽量なパッケージマネージャ
- monorepo（apps + packages）との相性が最高
- “重複しない・無駄がない” 点が UNIX 的

---

# UI / デザイン

## Tailwind CSS

- Utility-first により CSS 設計の複雑さを排除
- コンポーネント内部がシンプルで美しい構造に保てる

## shadcn/ui

- ライブラリではなく “コンポーネントのソースコード” を提供
- 自分のプロジェクト内で育てていける
- 黒箱を極力なくし UNIX 的な透明性が高い
- Tailwind + Radix UI ベースの安定構成

## lucide-react

- Feather Icons の精神を継ぐ OSS アイコンセット
- シンプル・軽量・統一感があり UI の土台として最適

## Framer Motion（必要に応じて）

- アニメーションを宣言的に作成可能
- 画面遷移・UI 反応・カード並べ替えなどに高い表現力
- 必須ではないため後から導入しても問題なし

---

# 状態管理 / データ取得

## Zustand

- 軽量で拡張可能。Redux のような複雑さなし
- DSL コマンド、ユーザー操作の一時状態などと相性が良い
- persist/devtools ミドルウェアでゲーム進行保存やデバッグが容易

## SWR

- データフェッチとキャッシュを自動化
- 状態管理（Zustand）と明確に責務分離できる

---

# バリデーション / 型安全

## Zod

- 実行時チェックで API / フォーム / DB の境界を完全に守る
- TypeScript と完全連動（型の単一ソース化）

## react-hook-form

- 管理画面の課題作成フォームなどで使用
- バリデーションとエラー管理が高速かつ明確
- Zod と組み合わせると「型・仕様・UI」が一元化

## ts-pattern

- DSL の命令分岐や状態マシンの処理を「漏れなく」書ける
- 分岐漏れをコンパイル時に検出できる → バグ予防に強い

---

# ORM / データベース

## Drizzle ORM

- schema-first & type-safe
- migration が SQL で生成され、IaC として資産化
- シンプルで透明性が高く、UNIX 的アプローチに近い

## PostgreSQL

- JSONB を活用して DSL やテストケースを柔軟に保存可能
- OSS DB として信頼性が高い

---

# テスト / 開発支援

## Vitest

- TypeScript ネイティブで高速
- DSL やゲームロジックのユニットテストに最適

## Playwright

- E2E テストで実際のユーザー操作を再現
- スマホ・PC 両対応で、ゲーム UX の検証に強い

## MSW (Mock Service Worker)

- API モックを簡単に作成
- UI 開発を API 完成待ちにしなくてよい
- テストの安定性が大幅に向上

---

# オーディオ

## howler.js

- BGM / 効果音の再生制御を統一
- モバイルブラウザの制限にも強い
- フェードやループなどゲームらしい演出に最適

---

# 技術選定の比較表

| 領域              | 選定技術             | 採用理由                   | 思想一致度 |
| ----------------- | -------------------- | -------------------------- | ---------- |
| UI 基盤           | Tailwind CSS         | シンプルで可読性が高い     | ★★★★★      |
| UI コンポーネント | shadcn/ui            | ソースが透明、育てられる   | ★★★★★      |
| アイコン          | lucide-react         | OSS・統一感・軽量          | ★★★★☆      |
| アニメーション    | Framer Motion        | リッチ UX を簡易に実現     | ★★★★☆      |
| 状態管理          | Zustand              | 小さい・単純・柔軟         | ★★★★★      |
| データフェッチ    | SWR                  | 役割分離が明確             | ★★★★☆      |
| バリデーション    | Zod                  | 型の単一ソース化           | ★★★★★      |
| フォーム          | react-hook-form      | バリデーション・性能が良い | ★★★★☆      |
| パターンマッチ    | ts-pattern           | DSL と相性抜群             | ★★★★★      |
| DB/ORM            | PostgreSQL + Drizzle | JSONB + 型安全 + IaC       | ★★★★★      |
| テスト            | Vitest               | TDD しやすい               | ★★★★★      |
| E2E               | Playwright           | マルチデバイス検証         | ★★★★☆      |
| API モック        | MSW                  | 開発効率とテスト安定性     | ★★★★☆      |
| 音管理            | howler.js            | ゲーム向け音制御           | ★★★★☆      |

---

# まとめ

本プロジェクト czz は以下の柱で構成されています：

- UNIX 的に「最小限で本質的なモジュール」を組み合わせる
- Zod・Drizzle を中心に型安全を貫く
- UI/UX は shadcn/ui, lucide, Framer Motion で強化
- ゲームとしての体験（アニメーション・サウンド・状態管理）は  
  Zustand / howler / Next.js を中心に構築
- TDD ＋ E2E プレイテストで教育ゲームとしての品質を担保

これらの技術は今後の拡張にも耐え、  
学習ゲームとして「触って楽しい・学んで楽しい」基盤となります。
